---
layout: post
title: 指令版_V1.0[Modbus-RTU]
category: 技术
tags: Modbus-RTU 485 智能 继电器
description: 把普通开关变成智能开关
---
> 11 故事要从2年前说起了。当时公司要搞智能灯，为了节约用电之类的就去找相关的信息，不小心进了关于HA的群里，然后就一发不可收拾。在淘宝不停的买买买，可怕！开始玩arduino 然后玩ESP8266 各种玩。小米套装，天猫精灵，无底洞…… 刚开始好异想天开的，家里不装开关都用天猫精灵喊算了，或者用小米的无线开关，但是在使用一段时间后发现，还是不如原来的机械开关体验感来的舒服。于是就有了指令板这个产品。  

## 问题分析
刚开始买的第一个485继电器产品走的是TCP，自带HTTP控制 挺好玩玩，还学习py写了脚本来接入HA来控制他，很有成就感。当时买的也是带输入量的，方便接开关。但是问题也随之而来，多联情况下不能使用普通的翘板开关，放线也是很大的问题。然后就去淘宝找相关的产品。 在淘宝发现 信科这个产品，他的继电器和指令板配合工作就可以解决这个问题。但是他的是私有协议，接入Ha就比较麻烦了。然后就有了现在这个产品，吸收信科指令板的优点结合Modbus作出了标准协议的 指令板 支持所有标准Modbus写的继电器方便使用。  

## 功能介绍
1. 该指令板支持Modbus协议的继电器。
2. 自带LED指示灯，支持状态反馈。
3. 可以使用普通翘板开关或者自复位两种类型的开关。  

## 使用说明
### 1.绑定继电器:
[00，功能，按钮，继电器地址，第几路，校验位]  
```python
00 70 00 01 00   //00，70，板子的第一个按钮，add是1的继电器，继电器板第一路
```
### 2.指定开关类型
[00，功能，数据，校验位]
```python
00 71 01  //自复位式开关
00 71 02  //翘板开关
```
### 3.指定led状态:(默认常灭)
[00，功能，数据，校验位]
```python
00 72 01 //常灭
00 72 02 //常亮
00 72 03 //打开灯亮
00 72 04 //打开灯灭
```
### 4.进入配置模式
(快速按6次进入配置模式，在2s内） 进入配置模式485 可以会接收到指令 00 77 00 00 00 校验码 电源，电源和开关指示灯同时闪烁。  

## 外观欣赏

## 续集预告
### 当前功能
1. 支持多键同时按
2. 支持LED4种模式
3. 支持2种开关类型
4. 支持modbus协议继电器控制
5. 支持LED反馈
### 预告功能
1. 实现非modbus协议继电器控制（指令：00 74 01 modbus ，00 74 02 自定义 ）
2. 实现一对多控制（最大支持10路继电器控制，全开或全关2个功能）
3. LED增加呼吸灯效果 （指令：00 72 05）
4. 带验证功能，发送失败时重新发送（随机取100ms-200ms延迟发送，防止二次冲突）